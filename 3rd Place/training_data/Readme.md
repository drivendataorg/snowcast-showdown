# Notebooks

The three jupyter notebook files here generate the training data files for TeamUArizona's submission 
to the Snowcast Showdown ('ground_measures_data.csv', 'train_label_data.csv', and 'ua_swe_data.csv', which
are created by 'Create_Ground_Measures_CSV.ipynb', 'Create_Train_Label_Data_CSV.ipynb', and 
'Create_UA_SWE_Data_CSV.ipynb', respectively)

'Create_Ground_Measures_CSV.ipynb' creates a file of predictor features used during model training.  The
script simply reads the ground measure data from the files provided for the Development Phase of the 
Snowcast Showdown, matches the features to the new grid system in the Evaluation Phase of the Snowcast 
Showdown, and writes out the data file. 

'Create_Train_Label_Data_CSV.ipynb' and 'Create_UA_SWE_Data_CSV.ipynb' create files for the target features
used during model training.  'Create_UA_SWE_Data_CSV.ipynb' puts UA SWE data into the table in 
'ua_swe_data.csv' by creating a lookup table of the map pixel to extract for each of the predicted grids 
(see 5th and 6th blocks of code in 'Create_UA_SWE_Data_CSV.ipynb').  Note that a single UA SWE pixel is 
extracted and assigned to each model grid cell.

'Create_Train_Label_Data_CSV.ipynb' is a more complicated script since it assembles the other training 
file ('train_label_data.csv') from multiple data sources.  'train_label_data.csv' contains Airborne 
Snow Observatory (ASO) data and SNOTEL/CDEC data for a limited number of predicted locations, but these 
data come from 1) the provided Snowcast Showdown data files, 2) additional ASO data, and 3) additional 
SNOTEL/CDEC data. Although the extra data largely overlaps with what is provided, there are a few 
differences, and the additional ASO and SNOTEL/CDEC data provides some extra training features. Extraction 
of the competition data simply involves matching the provided features to the new grid system in the 
Evaluation Phase of the Snowcast Showdown (see code blocks 5-7 in 'Create_Train_Label_Data_CSV.ipynb').  

ASO data is extracted similarly to the UA SWE data (by creating a lookup table of where to extract the 
map pixels for each model grid), though multiple 50m ASO pixels are extracted and averaged for each model 
grid (see code blocks 8-9).  SNOTEL/CDEC data is extracted by locating SNOTEL stations that correspond to 
model grids that must have SNOTEL/CDEC data (i.e. they have more snow measurements than has been flown by 
ASO), and collecting the available data for these grids (see code block 10).  Finally, the data are combined 
(block 11).  In most cases, the provided and additional data match fairly well (or perfectly in the case of 
many SNOTEL stations), but for some SNOTEL/CDEC stations that show disagreement, the choice of which data 
to ultimately include in the data file was determined manually (and reflected in the code logic).

The generated csv files are saved to the "Training Tables" directory.

# Data

The `Data` subfolder contains data used to develop the training data tables for Team UArizona's 
submission.  These data are organized into five subdirectories.

Data in the "Snowcast Development" and "Snowcast Evaluation" subdirectories are datafiles 
provided in this competition.  These data are used for the creation of the 
"train_label_data.csv" and "ground_measures_data.csv" training files.

"UASWE" contains UA SWE data (https://nsidc.org/data/nsidc-0719) downscaled to 1 km 
resolution that used to populate the "ua_swe_data.csv" training file. UA SWE data is 
gridded snowpack data based on interpolation of snow amount from thousands of SNOTEL/CDEC 
stations and National Weather Service Cooperative Observer stations across the conterminous 
United States using gridded climate data from Parameter Regression Independent Slopes Model 
(PRISM; Daly et al., 1997; The UA SWE data were originally generated at 4 km resolution,
but here, we use an 800 m version of these data based on 800 m PRISM data (generated by
combining 800 m PRISM monthly climatology data with 4 km daily PRISM data). These 800
m UA SWE data also include corrections to account for small scale effects of terrain and 
forest cover variability using machine learning of lidar snow datasets. They are
broadly similar to 4 km UA SWE data at larger (>= 10km) scales, but have some differences 
at local scales in areas with complex topography or substantial forest cover. 

The "ASO" and "Snotel" directories contain 50 m Airborne Snow Observatory (ASO) SWE grids 
and daily SNOTEL/CDEC station data (aggregated from 10/2010 to 9/2021), which is incorporated 
into "train_label_data.csv".  While their inclusion is less critical to our submission since 
they largely duplicate the features that are included in the competition files (for example, 
there is a perfect match between most of the SNOTEL features in these files and those in the 
competition files), they still provide a check on the data quality.  For example, some of the 
competition data had obvious spurious jumps for some of the CDEC data that did not occur in 
the external data (so it was judged better to use the external SNOTEL/CDEC data in 
train_label_data.csv.  There are also some additional ASO data that fill in some of the 
missing data in the provided files.  In general, the match between the ASO data in the 
competition files and the external ASO data was close, but in a very small number of cases, 
there were pixels that had zero values in the provided competition data in areas where the 
downloaded ASO data showed ‘no data’, and so the downloaded ASO data was perferred in cases of 
disagreement.
 
The SNOTEL data are provided as simple tables (that contain aggregated yearly snotel data).  
The ASO data is more complicated since some dates have multiple ASO flights, so the ASO 
spatial data files are referenced using virtual rasters (in the "ASO/vrt" folder) to facilitate 
easy incorporation using the script to generate "train_label_data.csv".  Commands for creating 
the vrt files, as well as other minor GIS processing (e.g. resampling to a common grid or clipping
out no-data areas) are given (e.g. in "ASO/vrt/commands.txt").  Note that the ASO directory also
contains a lookup structure used to pull the ASO data into the training tables (this structure
is created in "Create_Train_Label_Data_CSV.ipynb" if it does not exist, but is provided here for
convenience because it takes a while to generate).

ASO data can be downloaded from the NSIDC: (https://nsidc.org/data/aso/data) and the Airborne Snow 
Observatory website.

SNOTEL data are from the NRCS (https://www.nrcs.usda.gov/wps/portal/wcc/home/)
